(()=>{var e={924:e=>{e.exports=Object.freeze(new function(){this.TASKER_PATH="Tasker",this.MAX_WALLPAPERS=1e3,this.PREVIOUS_FILEPATH=this.TASKER_PATH+"/wallpaper/previous.json",this.IMAGE_PATH=this.TASKER_PATH+"/wallpaper/images/",this.REDDIT_CLIENT_BASE_URL="https://reddit.premii.com/#",this.REDDIT_WALLPAPER_SOURCE_URL="https://reddit.com/r/art.json",this.MIN_WIDTH=1080,this.MIN_HEIGHT=1920})}},t={};function i(a){var r=t[a];if(void 0!==r)return r.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,i),l.exports}(()=>{"use strict";const e=this;var t=i(924);const a=({url:e})=>RegExp(".(jpg|png|jpeg)$","i").test(e),r=(i,a=t.PREVIOUS_FILEPATH)=>(0,e.writeFile)(a,JSON.stringify(i)),l=(t,i)=>(0,e.performTask)("WallpaperNotification",10,t,i),s=(i=t.IMAGE_PATH)=>{const a=(0,e.listFiles)(i);return a?a.split("\n").reduce(((e,t)=>{const i=t.match(/(\w+)\.\w{3,4}$/);return i?(e.push({id:i[1],filePath:t}),e):e}),[]):[]},n=(i,a=t.IMAGE_PATH,o=t.PREVIOUS_FILEPATH)=>{console.log("Start offline");const p=s(a),h=i.filter((e=>Boolean(e)));if(!p.length||!i.length)return(0,e.flash)("Could not set offline wallpaper with no cached images"),i;const d=h.pop(),c=p.find((({id:e})=>e===d.id));return c||n(h),(0,e.setWallpaper)(c.filePath),l(d.title,`${t.REDDIT_CLIENT_BASE_URL}${d.permalink}`),(0,e.setGlobal)("WallpaperPostUrl",`${t.REDDIT_CLIENT_BASE_URL}${d.permalink}`),d.displayedLast=Date.now(),h.unshift(d),h.length=i.length,r(h,o),h},o=n,p=({width:e,height:i})=>e>=t.MIN_WIDTH&&i>=t.MIN_HEIGHT,h=async(i=[],s,n=t.IMAGE_PATH,o=t.PREVIOUS_FILEPATH,d=null)=>{const[c,E]=await(async i=>{const r=await(0,e.fetch)(`${t.REDDIT_WALLPAPER_SOURCE_URL}?limit=100${i?`&after=${i}`:""}`),l=await r.json(),s=l.data.children.map((e=>(({id:e,title:t,permalink:i,url:a,preview:r})=>({id:e,title:t,permalink:i,url:a,width:r&&r.images&&r.images.length&&r.images[0].source&&r.images[0].source.width?r.images[0].source.width:0,height:r&&r.images&&r.images.length&&r.images[0].source&&r.images[0].source.height?r.images[0].source.height:0}))(e.data)));return[l.data.after,s.filter(a).filter(p)]})(s),f=E.find((e=>!i.find((t=>t&&t.id===e.id))));if(!f){if(!c)throw new Error("Can not paginate without a after parameter");if(Boolean(d)&&d>=Date.now())throw new Error("Could not find new wallpaper within timeout");return h(i,c,n,o)}const[u]=f.url.match(/\.\w{3,4}($|\?)/),I=`${n}/${f.id}${u}`;await((t,i,a=30)=>new Promise(((r,l)=>(0,e.shell)(`cd /storage/emulated/0 && curl -L -f -o "${i}" "${t}" && echo d`,!1,a)?r():l(Error(`Could not download ${t} to /storage/emulated/0/${i}`)))))(f.url,I),(0,e.setWallpaper)(I),l(f.title,`${t.REDDIT_CLIENT_BASE_URL}${f.permalink}`),(0,e.setGlobal)("WallpaperPostUrl",`${t.REDDIT_CLIENT_BASE_URL}${f.permalink}`),f.displayedLast=Date.now(),i.unshift(f);const _=(0,e.global)("%WallpaperMemLength");return _||(0,e.setGlobal)("%WallpaperMemLength",t.MAX_WALLPAPERS),i.length=_||t.MAX_WALLPAPERS,r(i,o),i},d=async(e=[],i,a=t.IMAGE_PATH,r=t.PREVIOUS_FILEPATH,l=3e4)=>{console.log("Start online");const s=Date.now()+l;return await h(e,i,a,r,s)};(async()=>{try{l("Updating wallpaper...");const i=((i=t.PREVIOUS_FILEPATH)=>{try{return JSON.parse((0,e.readFile)(i)).sort(((e,t)=>e&&t?t.displayedLast-e.displayedLast:0)).filter(((e,t,i)=>!e||t===i.filter((e=>Boolean(e))).findIndex((t=>e.id===t.id))))}catch(t){"ENOENT"!==t.code&&console.error(t),(0,e.writeFile)(i,"[]")}return[]})(),[a,r]=(0,e.global)("%WIFII").match(/>>> (.+) <<</);(t=>{s().filter((({id:e})=>!t.find((t=>t&&t.id===e)))).forEach((({filePath:t})=>(0,e.deleteFile)(t)))})(await(process.argv.includes("--online")?d:process.argv.includes("--offline")?o:"CONNECTION"===r?d:o)(i))}catch(t){console.error(t),(0,e.flash)(t.toString())}(0,e.exit)()})()})()})();